<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>BurgerCoin ‚Äî Idle Tap</title>
<meta name="theme-color" content="#0a2a68"/>
<style>
:root {
  --bg:#0a2a68; --sky1:#224aa2; --sky2:#081b43;
  --panel:#121b36; --panel2:#1c2d5b;
  --gold1:#ffe082; --gold2:#ffca28; --gold3:#ffb300;
  --mint1:#b2ff59; --mint2:#69f0ae;
  --text:#fff; --muted:#c7d2fe;
  --shadow: 0 18px 32px rgba(0,0,0,.46);
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; overflow:hidden;
  background: radial-gradient(120% 120% at 50% 0%, var(--sky1) 0%, var(--bg) 55%, var(--sky2) 100%);
  color:var(--text); font-family: Inter, Roboto, Arial, sans-serif; }
.app{ 
  max-width:520px; 
  margin:0 auto; 
  height:100dvh; 
  display:flex; 
  flex-direction:column; 
  justify-content:space-between;
  transform: translateY(-7%);
}

/* SPLASH */
#splash{ position: fixed; inset: 0; background: radial-gradient(140% 140% at 50% 0%, #2b3f78 0%, #111a34 70%);
  display:flex; align-items:center; justify-content:center; flex-direction:column; z-index: 9999; transition: opacity .6s ease }
.splash-card{ background: linear-gradient(180deg, #22345f, #121b36); border:1px solid rgba(255,255,255,.1);
  padding:22px; border-radius:20px; box-shadow: var(--shadow); display:flex; flex-direction:column; align-items:center; }
.splash-progress{ width:260px; height:18px; border-radius:12px; overflow:hidden;
  background: rgba(255,255,255,.18); margin-top:16px; box-shadow: inset 0 2px 6px rgba(0,0,0,.35)}
#progress-bar{ height:100%; width:0%; background: linear-gradient(90deg, var(--gold1), var(--gold3)); transition: width .25s ease }

/* TOPBAR */
.topbar{ margin-top:30%; display:flex; justify-content:center; gap:14px;
  padding:10px 16px; background: linear-gradient(180deg, var(--panel2), var(--panel));
  border-radius:16px; box-shadow: var(--shadow); }
.pill{ display:flex; align-items:center; gap:6px; background: rgba(10,15,35,.8);
  border:1px solid rgba(255,255,255,.08); padding:6px 12px; border-radius:999px; box-shadow: inset 0 -2px 0 rgba(0,0,0,.2); }
.icoCoin{ width:20px; height:20px; border-radius:50%; }

/* SALDO */
.balance-pill {
  display:flex;
  justify-content:center;
  margin:14px 0;
}
.balance-pill .pill {
  font-weight:700;
  font-size:18px;
  animation: blink 1s infinite;
}
@keyframes blink {
  0%,100% { opacity:1; }
  50% { opacity:.6; }
}

/* TITOLO */
.title {
  text-align:center;
  font-size:28px;
  font-weight:900;
  color: var(--gold2);
  text-shadow: 0 0 6px var(--gold3), 0 0 14px rgba(255, 215, 0, 0.9);
  margin-top:2%;
  margin-bottom:2%;
}

/* QUADRANTE CENTRALE */
.coinContainer {
  flex:1;
  margin:0 5%;
  padding:20px;
  background: linear-gradient(180deg, rgba(0,0,0,.6), rgba(30,30,50,.9));
  border:2px solid var(--gold2);
  border-radius:22px;
  box-shadow: 0 6px 18px rgba(0,0,0,.6), inset 0 2px 8px rgba(255,255,255,.08);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  margin-top:5%;
  margin-bottom:2%;
}

/* XP BAR */
.progress{width:100%; display:flex; align-items:center; gap:10px; margin-bottom:20px;}
.track{
  flex:1; height:18px; border-radius:14px; background: rgba(255,255,255,.08);
  overflow:hidden; box-shadow: inset 0 2px 6px rgba(0,0,0,.5), 0 0 8px rgba(255,215,0,.4);
  border:1px solid rgba(255,255,255,.15);
}
.bar{
  height:100%; background: linear-gradient(90deg, var(--mint2), var(--mint1));
  width:0%; border-radius:14px;
  box-shadow: 0 0 10px rgba(105,240,174,.8);
}
.badge{font-size:13px;}

/* MONETA */
.coinBtn{ width:220px; height:220px; border-radius:50%;
  background:url('burger_image.png') center/cover no-repeat;
  cursor:pointer; position:relative; margin-top:10px; overflow:hidden;
}
.coinBtn::after{
  content:""; position:absolute; top:-50%; left:-50%;
  width:200%; height:200%; background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.6) 40%, transparent 80%);
  transform: rotate(25deg); animation: shine 4s infinite;
}
@keyframes shine {
  0% { transform: translateX(-100%) rotate(25deg); }
  50% { transform: translateX(100%) rotate(25deg); }
  100% { transform: translateX(200%) rotate(25deg); }
}

/* ANIMAZIONE CLICK */
@keyframes bounce {
  0% { transform: scale(1) rotate(0deg); }
  30% { transform: scale(1.15) rotate(8deg); }
  50% { transform: scale(.95) rotate(-6deg); }
  70% { transform: scale(1.05) rotate(4deg); }
  100% { transform: scale(1) rotate(0deg); }
}
.coinBtn.clicked {
  animation: bounce 0.4s ease;
}

/* COMBO */
.combo {
  margin-top:14px;
  font-size:20px;
  font-weight:700;
  color:var(--gold1);
  text-shadow:0 0 8px var(--gold3);
  transition: transform 0.1s ease;
}

/* BUTTONS */
.buttonContainer{
  display:flex;
  overflow-x:auto; gap:14px;
  padding:12px; margin:0 5% 6px; scrollbar-width:none;
}
.buttonContainer::-webkit-scrollbar{display:none;}
.button{
  flex:0 0 auto;
  background:linear-gradient(180deg,var(--panel2),var(--panel));
  color:var(--text);
  padding:14px 22px;
  border-radius:14px;
  font-size:17px;
  cursor:pointer;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.08);
}
.footer {
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin-bottom:8px;
}

/* POPUP */
.popup {
  position: absolute;
  color: var(--gold1);
  font-weight: 700;
  pointer-events: none;
  animation: popFade 0.8s ease-out forwards;
  text-shadow: 0 0 6px black;
}
@keyframes popFade {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-40px) scale(1.3); }
}
</style>
</head>
<body>
<!-- SUONO CLICK -->
<audio id="clickSound" src="click.wav" preload="auto"></audio>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-card">
    <img src="burger_image.png" alt="BurgerCoin logo" style="width:140px; border-radius:50%; margin-bottom:12px;"/>
    <div class="splash-logo" style="font-size:28px; font-weight:900; margin:6px 0;">üçî BurgerCoin</div>
    <div class="splash-progress"><div id="progress-bar"></div></div>
  </div>
</div>

<!-- GAME -->
<div class="app" id="app" aria-hidden="true">
  <div class="topbar">
    <div class="pill"><img src="burger_image.png" class="icoCoin"/> <b id="coins">0</b></div>
    <div class="pill">‚ö° <b id="energy">500</b> <small id="energyTimer" style="font-size:10px;opacity:0.7;margin-left:4px;">60s</small></div>
    <div class="pill">üíé <b id="gems">0</b></div>
  </div>

  <div class="balance-pill">
    <div class="pill">$ <b id="balance">0.00</b></div>
  </div>

  <h1 class="title">Burger Coin</h1>

  <div class="coinContainer">
    <div class="progress">
      <div class="badge">Lvl <b id="level">1</b></div>
      <div class="track"><div class="bar" id="xpbar"></div></div>
      <div class="badge"><b id="xptext">0/100 XP</b></div>
    </div>
    <div class="coinBtn" id="coinBtn"></div>
    <div class="combo" id="combo">Combo 1.00x</div>
  </div>

	<div class="buttonContainer">
  <a href="wallet.html" class="button">
    üí∞ Wallet
  </a>
  <a href="mission.html" class="button">
    üéØ Mission
  </a>
  <a href="wheel.html" class="button">
    üé° Wheel
  </a>
  <a href="upgrade.html" class="button">
    üîß Upgrade
  </a>
  <a href="burgerjack.html" class="button">
    üÉè Burger Jack
  </a>
  <a href="leaderboard.html" class="button">
    üèÜ Leaderboard
  </a>
</div>

  <div class="footer">by Burger Games</div>
</div>

<script>
	// Gestione variabili
let progress = 0;
const progressBar = document.getElementById("progress-bar");

function updateProgressBar() {
  // Aggiungo una progressione pi√π lenta
  progress += Math.random() * 10;  // Cambiato da 20 a 10 per rallentare la progressione
  if (progress >= 100) {
    progress = 100;
    setTimeout(() => {
      document.getElementById("splash").style.opacity = 0;
      setTimeout(() => {
        document.getElementById("splash").style.display = "none";
        document.getElementById("app").removeAttribute("aria-hidden");
        saveGame();
      }, 600);
    }, 300);
  }
  progressBar.style.width = progress + "%";
}

setInterval(updateProgressBar, 300);

// VARIABILI DI GIOCO
let coins = 0, energy = 500, xp = 0, level = 1, xpToNext = 100, combo = 1, balance = 0, gems = 0;
let comboTimer;

// RIFERIMENTI UI
const coinsEl = document.getElementById('coins');
const energyEl = document.getElementById('energy');
const xptextEl = document.getElementById('xptext');
const levelEl = document.getElementById('level');
const xpbarEl = document.getElementById('xpbar');
const comboEl = document.getElementById('combo');
const balanceEl = document.getElementById('balance');
const gemsEl = document.getElementById('gems');
const energyTimerEl = document.getElementById('energyTimer');

// PERSISTENZA
const SAVE_KEY = 'burgercoin_save_v1';
function saveGame() {
  // carico eventuali dati esistenti (per non perdere lastClaim_xxx)
  const raw = localStorage.getItem(SAVE_KEY);
  let oldData = raw ? JSON.parse(raw) : {};

  const data = {
    ...oldData, // mantieni lastClaim_xxx se esistono
    coins,
    energy,
    xp,
    level,
    xpToNext,
    combo,
    balance,
    gems,
    lastSave: Date.now()
  };

  localStorage.setItem(SAVE_KEY, JSON.stringify(data));
}


function loadGame() {
  const raw = localStorage.getItem(SAVE_KEY);
  if (!raw) return;
  let d;
  try {
    d = JSON.parse(raw);
    // Verifica se i dati sono validi
    if (typeof d.coins !== 'number' || typeof d.balance !== 'number') {
      throw new Error("Dati corrotti");
    }
  } catch (e) {
    console.error("Errore nel caricamento dei dati:", e);
    resetGame();  // Funzione per resettare i dati
    return;
  }

  coins = d.coins || 0;
  energy = d.energy || 500;
  xp = d.xp || 0;
  level = d.level || 1;
  xpToNext = d.xpToNext || 100;
  combo = d.combo || 1;
  balance = d.balance || 0;
  gems = d.gems || 0;

  updateUI(); // Aggiorna l'interfaccia utente
  updateProgressBar();
}


window.addEventListener('beforeunload', saveGame);
setInterval(saveGame, 5000); // Salva ogni 5 secondi

function updateUI() {
  // Coins (arrotondati interi)
  coinsEl.textContent = Math.floor(coins);

  // Balance calcolato in base ai coins
  balance = coins * 0.001;
  balanceEl.textContent = balance.toFixed(2);

  // Energia
  energyEl.textContent = energy;

  // XP e barra XP
  xptextEl.textContent = `${xp}/${xpToNext} XP`;
  levelEl.textContent = level;
  xpbarEl.style.width = (xp / xpToNext * 100) + "%";

  // Combo
  comboEl.textContent = `Combo ${combo.toFixed(2)}x`;

  // Gems
  gemsEl.textContent = gems;
}



// --- FUNZIONE POPUP ---
function showPopup(x, y, text, size = 16) {
  const popup = document.createElement("div");
  popup.className = "popup";
  popup.style.left = x + "px";
  popup.style.top = y + "px";
  popup.style.fontSize = size + "px";
  popup.textContent = text;
  document.body.appendChild(popup);
  setTimeout(() => popup.remove(), 800);
}

// --- TIMER ENERGIA ---
let energyCountdown = 60;
setInterval(() => {
  if (energy < 500) {
    energyCountdown--;
    if (energyCountdown <= 0) {
      energy = Math.min(500, energy + 2); // Aggiungi energia
      energyCountdown = 60;
      updateUI();
      saveGame();
    }
    energyTimerEl.textContent = energyCountdown + "s";
  } else {
    energyTimerEl.textContent = "MAX";
    energyCountdown = 60;
  }
}, 1000);

// CLICK MONETA
document.getElementById('coinBtn').addEventListener('click', (e) => {
  if (energy > 1) {
    let earnedCoins = Math.floor(1 * combo);
coins += earnedCoins;

    coins += earnedCoins;
    energy--; xp += 5;
    if (xp >= xpToNext) { xp = 0; level++; xpToNext = Math.floor(xpToNext * 1.5); }
    

    combo = Math.min(3, (combo + 0.01));
    comboEl.textContent = `Combo ${combo.toFixed(2)}x`;
    comboEl.style.transform = "scale(1.2)";
    setTimeout(() => comboEl.style.transform = "scale(1)", 100);

    clearTimeout(comboTimer);
    comboTimer = setTimeout(() => { combo = 1; comboEl.textContent = "Combo 1.00x"; saveGame(); }, 7000);

    updateUI(); saveGame();

    // ANIMAZIONE
    const coinBtn = document.getElementById('coinBtn');
    coinBtn.classList.remove('clicked');
    void coinBtn.offsetWidth;
    coinBtn.classList.add('clicked');

    // SUONO (funziona anche con click rapidi)
    const sound = new Audio("click.wav");
    sound.play().catch(()=>{});

    // POPUP +üçî
    const rect = coinBtn.getBoundingClientRect();
    const x = rect.left + rect.width / 2 + (Math.random() * 60 - 30);
    const y = rect.top + rect.height / 2 + (Math.random() * 60 - 30);
    const size = 14 + Math.min(earnedCoins, 30);
    showPopup(x, y, `+üçî${earnedCoins.toFixed(0)}`, size);
  }
});

loadGame(); updateUI();

</script>
</body>
</html>
